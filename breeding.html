<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PokeMMOIndex - Breeding Simulator</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .breeding-shell {
      max-width: 1360px;
      margin: 0 0 1.25rem;
      display: grid;
      gap: 1rem;
    }

    .breeding-layout {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
    }

    .breeding-main {
      flex: 1 1 auto;
      min-width: 0;
      display: grid;
      gap: 0.9rem;
    }

    .breeding-side {
      flex: 0 0 310px;
      width: 310px;
      display: grid;
      gap: 0.75rem;
      align-self: start;
      margin-top: -22px;
    }

    .breeding-controls {
      display: grid;
      gap: 1rem;
    }

    .breeding-control-row {
      display: grid;
      grid-template-columns: minmax(260px, 1.15fr) minmax(220px, 0.78fr) minmax(320px, 1.35fr);
      gap: 0.9rem;
      align-items: start;
      width: 100%;
    }

    .control-block {
      display: grid;
      gap: 0.4rem;
      padding: 0.7rem 0.75rem;
      border-radius: 0.65rem;
      border: 1px solid rgba(126, 191, 235, 0.2);
      background: rgba(18, 29, 44, 0.45);
    }

    .control-block > p {
      font-size: 0.95rem;
      line-height: 1.25;
    }

    .toggle-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(140px, 1fr));
      gap: 0.55rem;
    }

    .toggle-item {
      display: grid;
      gap: 0.3rem;
    }

    .toggle-item p {
      margin: 0;
      font-size: 0.9rem;
      line-height: 1.2;
    }

    .breeding-btn-group {
      display: inline-flex;
      gap: 0.45rem;
    }

    .breeding-btn {
      min-width: 44px;
      padding: 0.45rem 0.8rem;
      border-radius: 0.55rem;
      border: 1px solid rgba(78, 205, 196, 0.28);
      background: rgba(78, 205, 196, 0.12);
      color: var(--text-primary);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .breeding-btn:hover {
      border-color: rgba(255, 107, 107, 0.35);
      background: rgba(255, 107, 107, 0.12);
    }

    .breeding-btn.active {
      color: #e8f6ff;
      border-color: rgba(126, 191, 235, 0.55);
      background: rgba(74, 126, 167, 0.32);
    }

    .breeding-switch-wrap {
      display: inline-flex;
      align-items: center;
      gap: 0.55rem;
      padding: 0.45rem 0.7rem;
      border-radius: 0.55rem;
      border: 1px solid rgba(78, 205, 196, 0.25);
      background: rgba(78, 205, 196, 0.08);
    }

    .breeding-switch-wrap input[type="checkbox"] {
      width: 13px;
      height: 13px;
      accent-color: #4ecdc4;
      cursor: pointer;
    }

    .breeding-select-grid {
      display: grid;
      grid-template-columns: repeat(5, minmax(190px, 1fr));
      gap: 0.85rem;
    }

    .breeding-mid-row {
      display: grid;
      grid-template-columns: 1fr;
      gap: 0.85rem;
    }

    .breeding-stock {
      border: 1px solid rgba(126, 191, 235, 0.2);
      background: rgba(18, 29, 44, 0.45);
      border-radius: 0.65rem;
      padding: 0.65rem 0.75rem;
      display: grid;
      gap: 0.5rem;
    }

    .breeding-projects {
      border: 1px solid rgba(126, 191, 235, 0.2);
      background: rgba(18, 29, 44, 0.45);
      border-radius: 0.65rem;
      padding: 0.65rem 0.75rem;
      display: grid;
      gap: 0.45rem;
    }

    .breeding-projects input,
    .breeding-projects select {
      min-height: 34px;
      border-radius: 0.45rem;
      border: 1px solid rgba(78, 205, 196, 0.3);
      background: rgba(26, 31, 46, 0.9);
      color: var(--text-primary);
      padding: 0.35rem 0.5rem;
    }

    .breeding-project-actions {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 0.45rem;
    }

    .breeding-mini-btn {
      min-height: 32px;
      border-radius: 0.45rem;
      border: 1px solid rgba(78, 205, 196, 0.3);
      background: rgba(78, 205, 196, 0.1);
      color: var(--text-primary);
      cursor: pointer;
      font-size: 0.82rem;
    }

    .breeding-mini-btn.danger {
      border-color: rgba(255, 107, 107, 0.32);
      background: rgba(255, 107, 107, 0.12);
    }

    .breeding-stock-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: #d8ebff;
      margin: 0;
    }

    .breeding-stock-hint {
      font-size: 0.78rem;
      color: var(--text-secondary);
      line-height: 1.25;
      margin: 0;
    }

    .breeding-stock-row {
      display: grid;
      gap: 0.28rem;
      padding: 0.38rem 0.45rem;
      border-radius: 0.5rem;
      border: 1px solid rgba(78, 205, 196, 0.2);
      background: rgba(78, 205, 196, 0.05);
    }

    .breeding-stock-meta {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.45rem;
      color: #dceaf9;
      font-size: 0.8rem;
    }

    .breeding-stock-checks {
      display: flex;
      flex-wrap: wrap;
      gap: 0.25rem 0.4rem;
    }

    .breeding-stock-checks input[type="checkbox"] {
      width: 13px;
      height: 13px;
      accent-color: #4ecdc4;
      cursor: pointer;
    }

    .breeding-select-group {
      display: grid;
      gap: 0.35rem;
    }

    .breeding-select-group label {
      color: var(--text-secondary);
      font-size: 0.88rem;
    }

    .breeding-select-group select {
      min-height: 38px;
      border-radius: 0.5rem;
      border: 1px solid rgba(78, 205, 196, 0.3);
      background: rgba(26, 31, 46, 0.9);
      color: var(--text-primary);
      padding: 0.45rem 0.55rem;
    }

    .breeding-info {
      color: var(--text-secondary);
      font-size: 0.95rem;
      border: 1px solid rgba(255, 217, 61, 0.25);
      background: rgba(255, 217, 61, 0.08);
      border-radius: 0.65rem;
      padding: 0.75rem 0.85rem;
    }

    .breeding-info strong {
      color: #fff2b3;
    }

    .breeding-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.65rem;
      margin-top: 0.15rem;
    }

    .breeding-action-btn {
      padding: 0.5rem 0.85rem;
      border-radius: 0.5rem;
      border: 1px solid rgba(78, 205, 196, 0.3);
      background: rgba(78, 205, 196, 0.1);
      color: var(--text-primary);
      cursor: pointer;
    }

    .breeding-action-btn.danger {
      border-color: rgba(255, 107, 107, 0.32);
      background: rgba(255, 107, 107, 0.12);
    }

    .breeding-tree {
      display: block;
      overflow-x: auto;
      padding: 1rem 1.4rem 1rem;
      border-radius: 0.75rem;
      border: 1px solid rgba(78, 205, 196, 0.18);
      background:
        radial-gradient(120% 110% at 4% 0%, rgba(78, 205, 196, 0.08), transparent 45%),
        radial-gradient(120% 110% at 100% 100%, rgba(255, 107, 107, 0.08), transparent 48%),
        rgba(22, 28, 39, 0.72);
      width: 100%;
    }

    #treeWrap {
      margin-top: 0.25rem;
    }

    .tree-stage {
      position: relative;
      margin: 0;
    }

    .tree-lines {
      position: absolute;
      inset: 0;
      pointer-events: none;
    }

    .tree-node-wrap {
      position: absolute;
      transform: translate(-50%, -50%);
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      gap: 0.34rem;
    }

    .breeding-legend {
      display: flex;
      flex-wrap: wrap;
      gap: 0.8rem 1rem;
      align-items: center;
      margin-bottom: 0.2rem;
    }

    .breeding-tree-hint {
      color: var(--text-secondary);
      font-size: 0.8rem;
      margin-bottom: 0.15rem;
    }

    .breeding-guide-link {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      margin-bottom: 0.45rem;
      padding: 0.4rem 0.68rem;
      border-radius: 0.5rem;
      border: 1px solid rgba(78, 205, 196, 0.3);
      background: rgba(78, 205, 196, 0.1);
      color: #dff7f5;
      text-decoration: none;
      font-size: 0.84rem;
    }

    .breeding-guide-link:hover {
      border-color: rgba(255, 107, 107, 0.35);
      background: rgba(255, 107, 107, 0.12);
      color: #ffecec;
    }

    .breeding-legend-item {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      color: var(--text-secondary);
      font-size: 0.85rem;
    }

    .breeding-legend-dot {
      width: 0.9rem;
      height: 0.9rem;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.18);
    }

    .breed-row {
      display: grid;
      grid-template-columns: 118px auto;
      gap: 0.95rem;
      align-items: center;
      padding: 0.1rem 0.2rem;
      width: max-content;
      margin: 0 auto;
    }

    .breed-row-label {
      display: grid;
      gap: 0.2rem;
      align-content: center;
      justify-items: end;
      text-align: right;
      padding-left: 0.25rem;
    }

    .breed-row-title {
      color: #d8ebff;
      font-size: 0.82rem;
      font-weight: 600;
      letter-spacing: 0.02em;
    }

    .breed-row-meta {
      color: var(--text-secondary);
      font-size: 0.74rem;
    }

    .breed-row-nodes {
      display: flex;
      gap: 0.78rem;
      width: max-content;
      justify-content: center;
      align-items: center;
    }

    .breed-item-wrap {
      position: relative;
      flex: 1 1 0;
      text-align: center;
      min-height: 72px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .breed-node {
      width: var(--node-size, 40px);
      height: var(--node-size, 40px);
      position: relative;
      border-radius: 0.72rem;
      padding: 0;
      border: 1px solid rgba(118, 175, 220, 0.38);
      overflow: hidden;
      display: inline-flex;
      background: rgba(17, 24, 34, 0.92);
      cursor: pointer;
      gap: 0;
      box-shadow: 0 3px 12px rgba(0, 0, 0, 0.24);
      transition: transform 0.14s ease, box-shadow 0.18s ease, border-color 0.2s ease;
    }

    .breed-node-gender {
      position: absolute;
      right: 2px;
      top: 2px;
      min-width: 16px;
      height: 16px;
      padding: 0 2px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: 700;
      line-height: 1;
      color: #f3f8ff;
      border: 1px solid rgba(238, 247, 255, 0.88);
      box-shadow:
        0 0 0 1px rgba(8, 15, 24, 0.75),
        0 2px 6px rgba(0, 0, 0, 0.42);
      pointer-events: none;
      z-index: 2;
    }

    .breed-node-gender.male {
      background: rgba(58, 135, 255, 0.86);
    }

    .breed-node-gender.female {
      background: rgba(255, 97, 145, 0.86);
    }

    .breed-node:hover {
      transform: translateY(-1px);
      box-shadow: 0 7px 16px rgba(0, 0, 0, 0.28);
      border-color: rgba(126, 191, 235, 0.68);
    }

    .breed-node.active {
      border-color: #8bf88d;
      box-shadow:
        0 0 0 1px rgba(139, 248, 141, 0.25),
        0 10px 20px rgba(3, 35, 11, 0.4);
    }

    .breed-segment {
      flex: 1 1 0;
      height: 100%;
    }

    .breed-node-value {
      position: static;
      font-size: 0.56rem;
      line-height: 1;
      color: rgba(221, 236, 252, 0.82);
      letter-spacing: 0;
      white-space: nowrap;
      pointer-events: none;
    }

    .breed-connector-h {
      position: absolute;
      height: 2px;
      top: 50%;
      left: calc(50% + (var(--node-size, 40px) / 2) + 4px);
      width: calc(100% - (var(--node-size, 40px) / 2) - 8px);
      background: rgba(225, 236, 246, 0.65);
      transform: translateY(-50%);
      opacity: 0.85;
    }

    .breed-connector-v {
      position: absolute;
      width: 2px;
      top: 50%;
      left: -4px;
      height: calc(var(--node-size, 40px) + 16px);
      background: rgba(225, 236, 246, 0.65);
      transform: translateY(-50%);
      opacity: 0.82;
    }

    .breeding-hidden {
      display: none !important;
    }

    .breeding-toast {
      position: fixed;
      bottom: 18px;
      left: 18px;
      border-radius: 0.55rem;
      border: 1px solid rgba(255, 107, 107, 0.5);
      background: rgba(100, 19, 19, 0.96);
      color: #ffe6e6;
      padding: 0.65rem 0.85rem;
      font-size: 0.88rem;
      opacity: 0;
      pointer-events: none;
      transform: translateY(8px);
      transition: all 0.2s ease;
      z-index: 1200;
    }

    .breeding-toast.show {
      opacity: 1;
      transform: translateY(0);
    }

    @media (max-width: 1180px) {
      .breeding-layout {
        flex-direction: column;
      }
      .breeding-side {
        flex: 0 0 auto;
        width: 100%;
        margin-top: 0;
      }
    }

    @media (max-width: 760px) {
      .breeding-control-row {
        grid-template-columns: 1fr;
      }
      .toggle-grid {
        grid-template-columns: 1fr;
      }
      .breeding-select-grid {
        grid-template-columns: repeat(2, minmax(180px, 1fr));
      }
      .breeding-tree {
        padding: 0.5rem;
      }
    }

    @media (max-width: 620px) {
      .breeding-select-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <main class="page">
    <header class="hero panel">
      <div class="hero-top">
        <div>
          <h1 id="pageTitle">Breeding Simulator</h1>
          <p id="pageSubtitle">Build your breeding plan with IV targets, optional nature, cost estimate, and a visual tree.</p>
        </div>
        <div class="header-menu">
          <a href="index.html"><span class="nav-icon" aria-hidden="true"><svg viewBox="0 0 24 24"><path d="M3 10.5 12 3l9 7.5"/><path d="M5.5 9.5V20h13V9.5"/><path d="M9.5 20v-5h5v5"/></svg></span><span id="menuHome">Startseite</span></a>
          <a href="cosmetics.html"><span class="nav-icon" aria-hidden="true"><svg viewBox="0 0 24 24"><path d="m12 3 1.8 4.2L18 9l-4.2 1.8L12 15l-1.8-4.2L6 9l4.2-1.8z"/><path d="M5 16.5 6 19l2.5 1-2.5 1L5 23l-1-2.5L1.5 19 4 18z"/></svg></span><span id="menuCosmetics">Kosmetik</span></a>
          <a href="calendar.html"><span class="nav-icon" aria-hidden="true"><svg viewBox="0 0 24 24"><rect x="3.5" y="5.5" width="17" height="15" rx="2"/><path d="M7.5 3.5v4M16.5 3.5v4M3.5 9.5h17"/></svg></span><span id="menuCalendar">Kalender</span></a>
          <a href="guides.html"><span class="nav-icon" aria-hidden="true"><svg viewBox="0 0 24 24"><path d="M4.5 5.5h7a2 2 0 0 1 2 2v11h-7a2 2 0 0 0-2 2z"/><path d="M19.5 5.5h-7a2 2 0 0 0-2 2v11h7a2 2 0 0 1 2 2z"/></svg></span><span id="menuGuides">Anleitungen</span></a>
          <a class="active" href="breeding.html"><span class="nav-icon" aria-hidden="true"><svg viewBox="0 0 24 24"><path d="M8 4c3 0 3 4 6 4"/><path d="M8 20c3 0 3-4 6-4"/><circle cx="7" cy="4" r="1.5"/><circle cx="15" cy="8" r="1.5"/><circle cx="7" cy="20" r="1.5"/><circle cx="15" cy="16" r="1.5"/></svg></span><span id="menuBreeding">Zucht</span></a>
          <a href="https://github.com/NekoKasai/PokeMMOIndex" target="_blank" rel="noopener noreferrer"><span class="nav-icon" aria-hidden="true"><svg viewBox="0 0 24 24"><path d="M9 18 3 12l6-6"/><path d="m15 6 6 6-6 6"/></svg></span><span id="menuGitHub">GitHub</span></a>
          <div class="header-lang-group" aria-label="Language">
            <button type="button" class="header-lang-btn" data-lang="de">DE</button>
            <button type="button" class="header-lang-btn" data-lang="en">EN</button>
          </div>
        </div>
      </div>
    </header>

    <section class="breeding-shell panel">
      <div class="breeding-layout">
        <div class="breeding-main">
          <div class="breeding-controls">
            <div class="breeding-control-row">
              <div class="control-block">
                <p id="ivsLabel">Wie viele IVs willst du züchten?</p>
                <div class="breeding-btn-group">
                  <button type="button" class="breeding-btn iv-btn" data-iv-count="2">2</button>
                  <button type="button" class="breeding-btn iv-btn" data-iv-count="3">3</button>
                  <button type="button" class="breeding-btn iv-btn" data-iv-count="4">4</button>
                  <button type="button" class="breeding-btn iv-btn" data-iv-count="5">5</button>
                </div>
              </div>
              <div class="control-block">
                <p id="natureLabel">Wesen im Projekt berücksichtigen?</p>
                <label class="breeding-switch-wrap">
                  <input type="checkbox" id="natureSwitch" />
                  <span id="natureSwitchText">Ja / Nein</span>
                </label>
              </div>
              <div class="control-block">
                <div class="toggle-grid">
                  <div class="toggle-item">
                    <p id="valuesLabel">Werte unter Knoten anzeigen?</p>
                    <label class="breeding-switch-wrap">
                      <input type="checkbox" id="valuesSwitch" />
                      <span id="valuesSwitchText">Ein / Aus</span>
                    </label>
                  </div>
                  <div class="toggle-item">
                    <p id="genderLabel">Geschlecht anzeigen?</p>
                    <label class="breeding-switch-wrap">
                      <input type="checkbox" id="genderSwitch" />
                      <span id="genderSwitchText">Ein / Aus</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <div class="breeding-mid-row">
              <div id="selectGrid" class="breeding-select-grid"></div>
            </div>

            <div id="costInfo" class="breeding-info"></div>

            <div class="breeding-actions">
              <button type="button" id="startBtn" class="breeding-action-btn">Zucht starten</button>
              <button type="button" id="clearBtn" class="breeding-action-btn danger">Zurücksetzen</button>
            </div>
          </div>

          <div id="treeWrap" class="breeding-hidden">
            <div id="legend" class="breeding-legend"></div>
            <a id="breedingGuideLink" class="breeding-guide-link" href="guides.html#guide=breeding">
              <span class="link-icon">G</span><span id="breedingGuideLinkText">Zum Breeding-Guide</span>
            </a>
            <p id="treeHint" class="breeding-tree-hint">Klick auf einen Knoten, um ihn als erledigt zu markieren. Von oben (Basis) nach unten (Finale).</p>
            <div id="tree" class="breeding-tree"></div>
          </div>
        </div>

        <div class="breeding-side">
          <aside id="stockPanel" class="breeding-stock"></aside>
          <section class="breeding-projects">
            <p id="projectTitle" class="breeding-stock-title">Zucht-Projekte (Lokal)</p>
            <input id="projectNameInput" type="text" maxlength="40" placeholder="Projektname..." />
            <select id="projectSelect"></select>
            <div class="breeding-project-actions">
              <button type="button" id="projectSaveBtn" class="breeding-mini-btn">Speichern</button>
              <button type="button" id="projectLoadBtn" class="breeding-mini-btn">Laden</button>
              <button type="button" id="projectDeleteBtn" class="breeding-mini-btn danger">Löschen</button>
            </div>
          </section>
        </div>
      </div>
    </section>
  </main>

  <footer class="page-footer">
    <div class="page-footer-links">
      <a href="https://pokemmohub.com/tools/breeding/" target="_blank" rel="noopener noreferrer"><span class="link-icon">PH</span><span id="sourceTool">Quelle: PokeMMOHub Breeding Tool</span></a>
      <a href="https://github.com/NekoKasai/PokeMMOIndex" target="_blank" rel="noopener noreferrer"><span class="link-icon">GH</span>GitHub: NekoKasai/PokeMMOIndex</a>
    </div>
  </footer>

  <div id="toast" class="breeding-toast"></div>

  <script>
    (() => {
      const LANG_KEY = "site_lang";
      const VALID_LANGS = ["de", "en"];
      const BREEDING_KEY = "breeding_state_v1";
      const BREEDING_PROJECTS_KEY = "breeding_projects_v1";

      const STAT_ORDER = ["hp", "atk", "spatk", "def", "spdef", "spe", "nat"];
      const STAT_COLORS = {
        hp: "#55b651",
        atk: "#f72533",
        def: "#f78025",
        spatk: "#e925f7",
        spdef: "#f7e225",
        spe: "#25e2f7",
        nat: "#e0f1f4"
      };

      const TOURNAMENT = {
        I: {
          iv2: { 1: [[0], [1], [1], [2]], 2: [[0, 1], [1, 2]], 3: [[0, 1, 2]] },
          iv3: { 1: [[0], [1], [1], [2], [1], [2], [1], [3]], 2: [[0, 1], [1, 2], [1, 2], [1, 3]], 3: [[0, 1, 2], [1, 2, 3]], 4: [[0, 1, 2, 3]] },
          iv4: { 1: [[0], [1], [1], [2], [1], [2], [1], [3], [1], [2], [1], [3], [2], [3], [2], [4]], 2: [[0, 1], [1, 2], [1, 2], [1, 3], [1, 2], [1, 3], [2, 3], [2, 4]], 3: [[0, 1, 2], [1, 2, 3], [1, 2, 3], [2, 3, 4]], 4: [[0, 1, 2, 3], [1, 2, 3, 4]], 5: [[0, 1, 2, 3, 4]] },
          iv5: { 1: [[1], [2], [1], [3], [2], [3], [2], [4], [2], [3], [2], [4], [3], [4], [3], [5], [0], [2], [2], [3], [2], [3], [2], [4], [2], [3], [2], [4], [3], [4], [3], [5]], 2: [[1, 2], [1, 3], [2, 3], [2, 4], [2, 3], [2, 4], [3, 4], [3, 5], [0, 2], [2, 3], [2, 3], [2, 4], [2, 3], [2, 4], [3, 4], [3, 5]], 3: [[1, 2, 3], [2, 3, 4], [2, 3, 4], [3, 4, 5], [0, 2, 3], [2, 3, 4], [2, 3, 4], [3, 4, 5]], 4: [[1, 2, 3, 4], [2, 3, 4, 5], [0, 2, 3, 4], [2, 3, 4, 5]], 5: [[1, 2, 3, 4, 5], [0, 2, 3, 4, 5]], 6: [[1, 2, 3, 4, 5, 0]] }
        },
        M: {
          iv2: { 1: [[1], [2]], 2: [[1, 2]] },
          iv3: { 1: [[1], [2], [1], [3]], 2: [[1, 2], [1, 3]], 3: [[1, 2, 3]] },
          iv4: { 1: [[1], [2], [1], [3], [2], [3], [2], [4]], 2: [[1, 2], [1, 3], [2, 3], [2, 4]], 3: [[1, 2, 3], [2, 3, 4]], 4: [[1, 2, 3, 4]] },
          iv5: { 1: [[1], [2], [1], [3], [2], [3], [2], [4], [2], [3], [2], [4], [3], [4], [3], [5]], 2: [[1, 2], [1, 3], [2, 3], [2, 4], [2, 3], [2, 4], [3, 4], [3, 5]], 3: [[1, 2, 3], [2, 3, 4], [2, 3, 4], [3, 4, 5]], 4: [[1, 2, 3, 4], [2, 3, 4, 5]], 5: [[1, 2, 3, 4, 5]] }
        }
      };

      const FORM_VALUES = {
        random: { 2: [1, 1, 0, 0, 0], 3: [2, 1, 1, 0, 0], 4: [2, 3, 2, 1, 0], 5: [2, 5, 5, 3, 1] },
        nature: { 2: [2, 1, 0, 0, 0], 3: [4, 2, 1, 0, 0], 4: [6, 5, 3, 1, 0], 5: [2, 11, 10, 6, 2] }
      };

      const COSTS = {
        random: { 2: 20000, 3: 65000, 4: 155000, 5: 340000 },
        nature: { 2: 75000, 3: 170000, 4: 355000, 5: 715000 }
      };

      const I18N = {
        de: {
          menuHome: "Startseite",
          menuCosmetics: "Kosmetik",
          menuCalendar: "Kalender",
          menuGuides: "Anleitungen",
          menuBreeding: "Zucht",
          menuGitHub: "GitHub",
          pageTitle: "Breeding Simulator",
          pageSubtitle: "Plane dein Zuchtprojekt mit IV-Ziel, optionalem Wesen, Kostenübersicht und visuellem Zuchtbaum.",
          ivsLabel: "Wie viele IVs willst du züchten?",
          natureLabel: "Wesen im Projekt berücksichtigen?",
          natureSwitchText: "Ja / Nein",
          valuesLabel: "Werte unter Knoten anzeigen?",
          valuesSwitchText: "Ein / Aus",
          genderLabel: "Geschlecht anzeigen?",
          genderSwitchText: "Ein / Aus",
          genderMale: "Männlich",
          genderFemale: "Weiblich",
          genderFinal: "Finale",
          breedingGuideLinkText: "Zum Breeding-Guide",
          selectPrefix: "1x31 IV in...",
          startBtn: "Zucht starten",
          clearBtn: "Zurücksetzen",
          sourceTool: "Quelle: PokeMMOHub Breeding Tool",
          treeHint: "Klick auf einen Knoten, um ihn als erledigt zu markieren. Von oben (Basis) nach unten (Finale).",
          infoText: "Geschätzte Basis-Kosten: <strong>{cost}$</strong> | Benötigte 1x31-Zucht-Pokemon: <strong>{count}</strong>",
          stockTitle: "Vorhandene 1x31-Zucht-Pokemon",
          stockHint: "Hake ab, was du bereits hast.",
          stockDone: "{done}/{total}",
          projectTitle: "Zucht-Projekte (Lokal)",
          projectNamePlaceholder: "Projektname...",
          projectSaveBtn: "Speichern",
          projectLoadBtn: "Laden",
          projectDeleteBtn: "Löschen",
          projectEmpty: "Kein gespeichertes Projekt",
          projectSaved: "Projekt gespeichert.",
          projectLoaded: "Projekt geladen.",
          projectDeleted: "Projekt gelöscht.",
          projectNameMissing: "Bitte zuerst einen Projektnamen eingeben.",
          projectSelectMissing: "Bitte zuerst ein Projekt auswählen.",
          duplicateError: "Du kannst denselben Stat nicht mehrfach auswählen.",
          rowBase: "Basis",
          rowStep: "Schritt",
          rowFinal: "Finale",
          rowNodes: "{count} Knoten",
          stats: { hp: "KP", atk: "Angriff", def: "Verteidigung", spatk: "Sp.-Angriff", spdef: "Sp.-Verteidigung", spe: "Initiative", nat: "Wesen" }
        },
        en: {
          menuHome: "Home",
          menuCosmetics: "Cosmetics",
          menuCalendar: "Calendar",
          menuGuides: "Guides",
          menuBreeding: "Breeding",
          menuGitHub: "GitHub",
          pageTitle: "Breeding Simulator",
          pageSubtitle: "Build your breeding plan with IV targets, optional nature, cost estimate, and a visual tree.",
          ivsLabel: "How many IVs do you want?",
          natureLabel: "Consider nature in your project?",
          natureSwitchText: "Yes / No",
          valuesLabel: "Show values under nodes?",
          valuesSwitchText: "On / Off",
          genderLabel: "Show gender on nodes?",
          genderSwitchText: "On / Off",
          genderMale: "Male",
          genderFemale: "Female",
          genderFinal: "Final",
          breedingGuideLinkText: "Open Breeding Guide",
          selectPrefix: "1x31 IV in...",
          startBtn: "Start breeding",
          clearBtn: "Reset",
          sourceTool: "Source: PokeMMOHub Breeding Tool",
          treeHint: "Click a node to mark it done. Read from top (base) to bottom (final).",
          infoText: "Estimated base cost: <strong>{cost}$</strong> | Required 1x31 breeding Pokemon: <strong>{count}</strong>",
          stockTitle: "Owned 1x31 breeding Pokemon",
          stockHint: "Check what you already have.",
          stockDone: "{done}/{total}",
          projectTitle: "Breeding Projects (Local)",
          projectNamePlaceholder: "Project name...",
          projectSaveBtn: "Save",
          projectLoadBtn: "Load",
          projectDeleteBtn: "Delete",
          projectEmpty: "No saved project",
          projectSaved: "Project saved.",
          projectLoaded: "Project loaded.",
          projectDeleted: "Project deleted.",
          projectNameMissing: "Please enter a project name first.",
          projectSelectMissing: "Please select a project first.",
          duplicateError: "You can't use the same stat in multiple fields.",
          rowBase: "Base",
          rowStep: "Step",
          rowFinal: "Final",
          rowNodes: "{count} nodes",
          stats: { hp: "HP", atk: "Attack", def: "Defense", spatk: "Sp. Attack", spdef: "Sp. Defense", spe: "Speed", nat: "Nature" }
        }
      };

      const headerLangButtons = document.querySelectorAll(".header-lang-btn[data-lang]");
      const ivButtons = document.querySelectorAll(".iv-btn[data-iv-count]");
      const natureSwitch = document.getElementById("natureSwitch");
      const valuesSwitch = document.getElementById("valuesSwitch");
      const genderSwitch = document.getElementById("genderSwitch");
      const selectGrid = document.getElementById("selectGrid");
      const stockPanel = document.getElementById("stockPanel");
      const projectNameInput = document.getElementById("projectNameInput");
      const projectSelect = document.getElementById("projectSelect");
      const projectSaveBtn = document.getElementById("projectSaveBtn");
      const projectLoadBtn = document.getElementById("projectLoadBtn");
      const projectDeleteBtn = document.getElementById("projectDeleteBtn");
      const costInfo = document.getElementById("costInfo");
      const startBtn = document.getElementById("startBtn");
      const clearBtn = document.getElementById("clearBtn");
      const treeWrap = document.getElementById("treeWrap");
      const tree = document.getElementById("tree");
      const legend = document.getElementById("legend");
      const toast = document.getElementById("toast");

      const normalizeLang = (value) => (VALID_LANGS.includes(value) ? value : "en");
      const loadProjects = () => {
        try {
          const raw = JSON.parse(localStorage.getItem(BREEDING_PROJECTS_KEY) || "{}");
          return raw && typeof raw === "object" ? raw : {};
        } catch {
          return {};
        }
      };
      const saveProjects = (projects) => {
        localStorage.setItem(BREEDING_PROJECTS_KEY, JSON.stringify(projects));
      };

      const defaultState = () => ({
        lang: normalizeLang(localStorage.getItem(LANG_KEY)),
        ivsCount: 5,
        nature: false,
        showNodeValues: false,
        showGender: true,
        stockChecks: {},
        isBreeding: false,
        iv: { 1: "hp", 2: "atk", 3: "def", 4: "spdef", 5: "spe" },
        bred: []
      });

      let state = (() => {
        try {
          const saved = JSON.parse(localStorage.getItem(BREEDING_KEY) || "null");
          if (!saved || typeof saved !== "object") return defaultState();
          return {
            ...defaultState(),
            ...saved,
            lang: normalizeLang(saved.lang || localStorage.getItem(LANG_KEY)),
            ivsCount: [2, 3, 4, 5].includes(saved.ivsCount) ? saved.ivsCount : 5,
            nature: !!saved.nature,
            showNodeValues: !!saved.showNodeValues,
            showGender: saved.showGender !== false,
            stockChecks: saved.stockChecks && typeof saved.stockChecks === "object" ? saved.stockChecks : {},
            isBreeding: !!saved.isBreeding,
            iv: { ...defaultState().iv, ...(saved.iv || {}) },
            bred: Array.isArray(saved.bred) ? saved.bred : []
          };
        } catch {
          return defaultState();
        }
      })();

      const statLabel = (statId) => I18N[state.lang].stats[statId] || statId;
      const statMiniLabel = (statId) => {
        const map = state.lang === "de"
          ? { hp: "KP", atk: "Atk", def: "Def", spatk: "SpA", spdef: "SpV", spe: "Init", nat: "Wes" }
          : { hp: "HP", atk: "Atk", def: "Def", spatk: "SpA", spdef: "SpD", spe: "Spe", nat: "Nat" };
        return map[statId] || statId;
      };
      const formValues = () => (state.nature ? FORM_VALUES.nature[state.ivsCount] : FORM_VALUES.random[state.ivsCount]);
      const estimatedCost = () => (state.nature ? COSTS.nature[state.ivsCount] : COSTS.random[state.ivsCount]);
      const tournamentMode = () => (state.nature ? "I" : "M");

      const setActiveLangButton = (lang) => {
        headerLangButtons.forEach((btn) => btn.classList.toggle("active", btn.dataset.lang === lang));
      };

      const persist = () => {
        localStorage.setItem(LANG_KEY, state.lang);
        localStorage.setItem(BREEDING_KEY, JSON.stringify(state));
      };

      const showToast = (message) => {
        toast.textContent = message;
        toast.classList.add("show");
        window.setTimeout(() => toast.classList.remove("show"), 2600);
      };

      const applyText = () => {
        const t = I18N[state.lang];
        document.documentElement.lang = state.lang;
        setActiveLangButton(state.lang);

        const ids = ["menuHome", "menuCosmetics", "menuCalendar", "menuGuides", "menuBreeding", "menuGitHub", "pageTitle", "pageSubtitle", "ivsLabel", "natureLabel", "natureSwitchText", "valuesLabel", "valuesSwitchText", "genderLabel", "genderSwitchText", "breedingGuideLinkText", "startBtn", "clearBtn", "sourceTool", "treeHint", "projectTitle", "projectSaveBtn", "projectLoadBtn", "projectDeleteBtn"];
        ids.forEach((id) => {
          const el = document.getElementById(id);
          if (el && t[id]) el.textContent = t[id];
        });
        if (projectNameInput) projectNameInput.placeholder = t.projectNamePlaceholder;
      };

      const renderProjects = () => {
        const t = I18N[state.lang];
        const projects = loadProjects();
        const names = Object.keys(projects).sort((a, b) => a.localeCompare(b, state.lang));
        projectSelect.innerHTML = "";
        if (!names.length) {
          const option = document.createElement("option");
          option.value = "";
          option.textContent = t.projectEmpty;
          projectSelect.appendChild(option);
          projectSelect.disabled = true;
          return;
        }
        projectSelect.disabled = false;
        names.forEach((name) => {
          const option = document.createElement("option");
          option.value = name;
          option.textContent = name;
          projectSelect.appendChild(option);
        });
      };

      const renderSelects = () => {
        const t = I18N[state.lang];
        const counts = formValues();
        selectGrid.innerHTML = "";
        counts.forEach((amount, idx) => {
          if (!amount) return;
          const id = idx + 1;
          const wrap = document.createElement("div");
          wrap.className = "breeding-select-group";
          const label = document.createElement("label");
          label.setAttribute("for", `iv${id}`);
          label.textContent = `${amount} ${t.selectPrefix}`;
          const select = document.createElement("select");
          select.id = `iv${id}`;
          ["hp", "atk", "def", "spatk", "spdef", "spe"].forEach((stat) => {
            const option = document.createElement("option");
            option.value = stat;
            option.textContent = statLabel(stat);
            if (state.iv[id] === stat) option.selected = true;
            select.appendChild(option);
          });
          select.addEventListener("change", () => {
            state.iv[id] = select.value;
            persist();
            renderTree();
            renderStock();
          });
          wrap.appendChild(label);
          wrap.appendChild(select);
          selectGrid.appendChild(wrap);
        });
      };

      const renderInfo = () => {
        const t = I18N[state.lang];
        const count = formValues().reduce((sum, n) => sum + n, 0);
        costInfo.innerHTML = t.infoText.replace("{cost}", estimatedCost().toLocaleString(state.lang === "de" ? "de-DE" : "en-US")).replace("{count}", count);
      };

      const getStockEntries = () => {
        const counts = formValues();
        const grouped = {};
        counts.forEach((amount, idx) => {
          if (!amount) return;
          const stat = state.iv[idx + 1];
          if (!stat) return;
          if (!grouped[stat]) grouped[stat] = 0;
          grouped[stat] += amount;
        });
        return Object.entries(grouped).map(([stat, total]) => ({ stat, total }));
      };

      const ensureStockChecks = (entries) => {
        const next = {};
        entries.forEach(({ stat, total }) => {
          const prev = Array.isArray(state.stockChecks[stat]) ? state.stockChecks[stat] : [];
          const arr = [];
          for (let i = 0; i < total; i += 1) arr.push(!!prev[i]);
          next[stat] = arr;
        });
        state.stockChecks = next;
      };

      const renderStock = () => {
        const t = I18N[state.lang];
        const entries = getStockEntries();
        ensureStockChecks(entries);
        stockPanel.innerHTML = "";

        const title = document.createElement("p");
        title.className = "breeding-stock-title";
        title.textContent = t.stockTitle;
        stockPanel.appendChild(title);

        const hint = document.createElement("p");
        hint.className = "breeding-stock-hint";
        hint.textContent = t.stockHint;
        stockPanel.appendChild(hint);

        entries.forEach(({ stat, total }) => {
          const row = document.createElement("div");
          row.className = "breeding-stock-row";

          const checks = state.stockChecks[stat] || [];
          const done = checks.filter(Boolean).length;

          const meta = document.createElement("div");
          meta.className = "breeding-stock-meta";
          const left = document.createElement("span");
          left.textContent = statLabel(stat);
          const right = document.createElement("span");
          right.textContent = t.stockDone.replace("{done}", String(done)).replace("{total}", String(total));
          meta.appendChild(left);
          meta.appendChild(right);
          row.appendChild(meta);

          const checkWrap = document.createElement("div");
          checkWrap.className = "breeding-stock-checks";
          for (let i = 0; i < total; i += 1) {
            const input = document.createElement("input");
            input.type = "checkbox";
            input.checked = !!checks[i];
            input.addEventListener("change", () => {
              state.stockChecks[stat][i] = !!input.checked;
              persist();
              renderStock();
            });
            checkWrap.appendChild(input);
          }
          row.appendChild(checkWrap);
          stockPanel.appendChild(row);
        });

        persist();
      };

      const renderIvButtons = () => {
        ivButtons.forEach((btn) => {
          const count = Number(btn.dataset.ivCount);
          btn.classList.toggle("active", count === state.ivsCount);
        });
      };

      const getPrerequisiteKeys = (row, col) => {
        const keys = [];
        for (let r = 1; r <= row; r += 1) {
          const span = Math.pow(2, row - r);
          const start = col * span;
          const end = start + span - 1;
          for (let c = start; c <= end; c += 1) {
            keys.push(`${r}-${c}`);
          }
        }
        return keys;
      };

      const toggleBred = (row, col) => {
        const targetKey = `${row}-${col}`;
        const set = new Set(state.bred);
        const related = getPrerequisiteKeys(row, col);
        if (set.has(targetKey)) {
          related.forEach((k) => set.delete(k));
        } else {
          related.forEach((k) => set.add(k));
        }
        state.bred = Array.from(set);
        persist();
        renderTree();
      };

      const renderLegend = () => {
        legend.innerHTML = "";
        const selected = Object.values(state.iv).filter(Boolean);
        const statIds = [];
        selected.forEach((stat) => {
          if (!statIds.includes(stat)) statIds.push(stat);
        });
        if (state.nature) statIds.push("nat");
        statIds.forEach((stat) => {
          const item = document.createElement("div");
          item.className = "breeding-legend-item";
          const dot = document.createElement("span");
          dot.className = "breeding-legend-dot";
          dot.style.background = STAT_COLORS[stat] || "#999";
          const txt = document.createElement("span");
          txt.textContent = statLabel(stat);
          item.appendChild(dot);
          item.appendChild(txt);
          legend.appendChild(item);
        });
      };

      const renderTree = () => {
        if (!state.isBreeding) {
          treeWrap.classList.add("breeding-hidden");
          tree.innerHTML = "";
          return;
        }

        const mode = tournamentMode();
        const t = I18N[state.lang];
        const ivKey = `iv${state.ivsCount}`;
        const data = TOURNAMENT[mode][ivKey];
        const totalRows = state.nature ? state.ivsCount + 1 : state.ivsCount;
        const baseCount = Math.pow(2, totalRows - 1);
        const nodeSizeForRow = (row) => Math.round(17 + row * 5);
        const maxNodeSize = nodeSizeForRow(totalRows);
        const baseXGap = totalRows >= 6 ? 38 : (totalRows === 5 ? 44 : 52);
        const yGap = totalRows >= 6 ? 84 : 92;
        const padX = 24;
        const padY = state.showNodeValues ? 34 : 26;
        const xGap = baseXGap;
        const stageWidth = (padX * 2) + ((baseCount - 1) * xGap) + maxNodeSize;
        const stageHeight = (padY * 2) + ((totalRows - 1) * yGap) + maxNodeSize + (state.showNodeValues ? 18 : 0);

        treeWrap.classList.remove("breeding-hidden");
        renderLegend();
        tree.innerHTML = "";
        const stage = document.createElement("div");
        stage.className = "tree-stage";
        stage.style.width = `${stageWidth}px`;
        stage.style.height = `${stageHeight}px`;

        const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        svg.classList.add("tree-lines");
        svg.setAttribute("width", String(stageWidth));
        svg.setAttribute("height", String(stageHeight));
        stage.appendChild(svg);

        const positions = {};
        const firstCenterX = padX + (maxNodeSize / 2);

        for (let row = 1; row <= totalRows; row += 1) {
          const count = Math.pow(2, totalRows - row);
          const size = nodeSizeForRow(row);
          const y = padY + ((row - 1) * yGap) + (size / 2);
          for (let col = 0; col < count; col += 1) {
            let x = 0;
            if (row === 1) {
              x = firstCenterX + (col * xGap);
            } else {
              const leftChild = positions[`${row - 1}-${col * 2}`];
              const rightChild = positions[`${row - 1}-${(col * 2) + 1}`];
              x = (leftChild.x + rightChild.x) / 2;
            }
            positions[`${row}-${col}`] = { x, y, size };
          }
        }

        for (let row = 2; row <= totalRows; row += 1) {
          const count = Math.pow(2, totalRows - row);
          for (let col = 0; col < count; col += 1) {
            const parent = positions[`${row}-${col}`];
            const leftChild = positions[`${row - 1}-${col * 2}`];
            const rightChild = positions[`${row - 1}-${(col * 2) + 1}`];
            const yLine = leftChild.y;
            const xLeft = leftChild.x + (leftChild.size / 2);
            const xRight = rightChild.x - (rightChild.size / 2);
            const parentTop = parent.y - (parent.size / 2);

            const h = document.createElementNS("http://www.w3.org/2000/svg", "line");
            h.setAttribute("x1", String(xLeft));
            h.setAttribute("y1", String(yLine));
            h.setAttribute("x2", String(xRight));
            h.setAttribute("y2", String(yLine));
            h.setAttribute("stroke", "rgba(235, 241, 248, 0.82)");
            h.setAttribute("stroke-width", "1.8");
            h.setAttribute("stroke-linecap", "round");
            svg.appendChild(h);

            const v = document.createElementNS("http://www.w3.org/2000/svg", "line");
            v.setAttribute("x1", String(parent.x));
            v.setAttribute("y1", String(yLine));
            v.setAttribute("x2", String(parent.x));
            v.setAttribute("y2", String(parentTop));
            v.setAttribute("stroke", "rgba(235, 241, 248, 0.82)");
            v.setAttribute("stroke-width", "1.8");
            v.setAttribute("stroke-linecap", "round");
            svg.appendChild(v);
          }
        }

        for (let row = 1; row <= totalRows; row += 1) {
          const count = Math.pow(2, totalRows - row);
          for (let col = 0; col < count; col += 1) {
            const pos = positions[`${row}-${col}`];
            const wrap = document.createElement("div");
            wrap.className = "tree-node-wrap";
            wrap.style.left = `${pos.x}px`;
            wrap.style.top = `${pos.y}px`;

            const node = document.createElement("button");
            node.type = "button";
            node.className = "breed-node";
            node.style.width = `${pos.size}px`;
            node.style.height = `${pos.size}px`;
            const key = `${row}-${col}`;
            if (state.bred.includes(key)) {
              node.classList.add("active");
              node.style.borderWidth = `${Math.max(2, row + 1)}px`;
            }

            const pattern = data[String(row)][col];
            const mapped = pattern.map((slot) => (slot === 0 ? "nat" : state.iv[slot]));
            const gender = row === totalRows ? "final" : (col % 2 === 0 ? "male" : "female");
            const genderText = gender === "male" ? t.genderMale : (gender === "female" ? t.genderFemale : t.genderFinal);
            node.title = state.showGender
              ? `${mapped.map((id) => statLabel(id)).join(" + ")} | ${genderText}`
              : mapped.map((id) => statLabel(id)).join(" + ");
            mapped.forEach((stat) => {
              const seg = document.createElement("span");
              seg.className = "breed-segment";
              seg.style.background = STAT_COLORS[stat] || "#999";
              node.appendChild(seg);
            });
            if (state.showGender && gender !== "final") {
              const badge = document.createElement("span");
              badge.className = `breed-node-gender ${gender}`;
              badge.textContent = gender === "male" ? "\u2642" : "\u2640";
              badge.title = genderText;
              node.appendChild(badge);
            }

            node.addEventListener("click", () => toggleBred(row, col));
            wrap.appendChild(node);
            if (state.showNodeValues && row === 1) {
              const value = document.createElement("span");
              value.className = "breed-node-value";
              value.textContent = statMiniLabel(mapped[0]);
              wrap.appendChild(value);
            }
            stage.appendChild(wrap);
          }
        }
        tree.appendChild(stage);
        tree.scrollLeft = 0;
      };

      const validateUniqueStats = () => {
        const counts = formValues();
        const used = [];
        counts.forEach((amount, idx) => {
          if (!amount) return;
          used.push(state.iv[idx + 1]);
        });
        return new Set(used).size === used.length;
      };

      const render = () => {
        applyText();
        natureSwitch.checked = state.nature;
        valuesSwitch.checked = state.showNodeValues;
        genderSwitch.checked = state.showGender;
        renderIvButtons();
        renderSelects();
        renderInfo();
        renderStock();
        renderProjects();
        renderTree();
        persist();
      };

      headerLangButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          state.lang = normalizeLang(btn.dataset.lang);
          render();
        });
      });

      ivButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          const next = Number(btn.dataset.ivCount);
          if (!next || next === state.ivsCount) return;
          state.ivsCount = next;
          state.isBreeding = false;
          state.bred = [];
          render();
        });
      });

      natureSwitch.addEventListener("change", () => {
        state.nature = !!natureSwitch.checked;
        state.isBreeding = false;
        state.bred = [];
        render();
      });

      valuesSwitch.addEventListener("change", () => {
        state.showNodeValues = !!valuesSwitch.checked;
        render();
      });

      genderSwitch.addEventListener("change", () => {
        state.showGender = !!genderSwitch.checked;
        renderTree();
        persist();
      });

      startBtn.addEventListener("click", () => {
        if (!validateUniqueStats()) {
          showToast(I18N[state.lang].duplicateError);
          return;
        }
        state.isBreeding = true;
        render();
      });

      clearBtn.addEventListener("click", () => {
        state = defaultState();
        render();
      });

      projectSaveBtn.addEventListener("click", () => {
        const t = I18N[state.lang];
        const name = (projectNameInput.value || "").trim();
        if (!name) {
          showToast(t.projectNameMissing);
          return;
        }
        const projects = loadProjects();
        projects[name] = { ...state };
        saveProjects(projects);
        renderProjects();
        projectSelect.value = name;
        showToast(t.projectSaved);
      });

      projectLoadBtn.addEventListener("click", () => {
        const t = I18N[state.lang];
        const name = projectSelect.value;
        if (!name) {
          showToast(t.projectSelectMissing);
          return;
        }
        const projects = loadProjects();
        if (!projects[name]) {
          showToast(t.projectSelectMissing);
          return;
        }
        const next = projects[name];
        state = {
          ...defaultState(),
          ...next,
          lang: state.lang,
          ivsCount: [2, 3, 4, 5].includes(next.ivsCount) ? next.ivsCount : 5,
          nature: !!next.nature,
          showNodeValues: !!next.showNodeValues,
          showGender: next.showGender !== false,
          stockChecks: next.stockChecks && typeof next.stockChecks === "object" ? next.stockChecks : {},
          isBreeding: !!next.isBreeding,
          iv: { ...defaultState().iv, ...(next.iv || {}) },
          bred: Array.isArray(next.bred) ? next.bred : []
        };
        projectNameInput.value = name;
        render();
        showToast(t.projectLoaded);
      });

      projectDeleteBtn.addEventListener("click", () => {
        const t = I18N[state.lang];
        const name = projectSelect.value;
        if (!name) {
          showToast(t.projectSelectMissing);
          return;
        }
        const projects = loadProjects();
        if (projects[name]) {
          delete projects[name];
          saveProjects(projects);
          renderProjects();
          showToast(t.projectDeleted);
        }
      });

      render();
    })();
  </script>
</body>
</html>
